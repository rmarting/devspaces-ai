schemaVersion: 2.2.0
metadata:
  name: vscode-continue-ai-env
  description: "VS Code environment with Continue.dev AI assistant pre-installed"

components:
  # The VS Code editor component (extensions via .vscode/extensions.json)
  - name: vscode-editor
    container:
      image: quay.io/devfile/universal-developer-image:latest
      #memoryLimit: 4Gi
      mountSources: true
      # Continue uses this env var for the model API key (inject via Secret with mount-as: env)
      env:
        - name: CONTINUE_API_KEY
          value: ""

  # Optional: Adding a dedicated container for your runtime (e.g., Python, Node)
  - name: runtime
    container:
      image: quay.io/devfile/universal-developer-image:latest
      #memoryLimit: 2Gi

commands:
  # Copy repo .continue/config.yaml to user home so Continue uses it
  - id: copy-continue-config
    exec:
      component: vscode-editor
      commandLine: "sh -c \"echo '[postStart] Copying .continue/config.yaml to ~/.continue...' && mkdir -p /home/user/.continue && cp $PROJECTS_ROOT/.continue/config.yaml /home/user/.continue/config.yaml && echo '[postStart] Done: .continue/config.yaml copied to ~/.continue'\""

  # Install Continue CLI globally
  - id: install-continue-cli
    exec:
      component: vscode-editor
      commandLine: "sh -c \"echo '[postStart] Installing Continue CLI (npm i -g @continuedev/cli)...' && npm i -g @continuedev/cli && echo '[postStart] Done: Continue CLI installed'\""

events:
  postStart:
    - copy-continue-config
    - install-continue-cli
